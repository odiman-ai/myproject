<!DOCTYPE html>
<html>
<head>
  <title>Program Enrollment</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { color: #2c3e50; }
    select, button { margin: 10px 0; padding: 8px; }
    .program-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>Program Enrollment</h2>

  <label for="beneficiary_id">Select Beneficiary:</label>
  <select id="beneficiary_id"></select>
  <button onclick="loadEligiblePrograms()">Check Eligibility</button>

  <div id="eligible_programs"></div>

  <script>
    // Load beneficiaries into dropdown
    fetch('get_beneficiaries.php')
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById('beneficiary_id');
        data.forEach(b => {
          const option = document.createElement('option');
          option.value = b.id;
          option.textContent = b.name;
          select.appendChild(option);
        });
      });

    // Load eligible programs
    function loadEligiblePrograms() {
      const id = document.getElementById('beneficiary_id').value;
      fetch(`check_eligibility.php?id=${id}`)
        .then(res => res.json())
        .then(programs => {
          const container = document.getElementById('eligible_programs');
          container.innerHTML = '<h3>Eligible Programs</h3>';
          programs.forEach(p => {
            const div = document.createElement('div');
            div.className = 'program-card';
            div.innerHTML = `
              <strong>${p.name}</strong><br>
              ${p.description}<br>
              <button onclick="enroll(${id}, ${p.id})">Enroll</button>
            `;
            container.appendChild(div);
          });
        });
    }

    // Enroll beneficiary
    function enroll(beneficiaryId, programId) {
      fetch('enroll_beneficiary.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({beneficiary_id: beneficiaryId, program_id: programId})
      })
      .then(res => res.json())
      .then(response => {
        alert(response.status === 'success' ? 'Enrollment successful!' : 'Error: ' + response.message);
      });
    }
  </script>

</body>
</html>
